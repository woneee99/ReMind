<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Enjoy Trip</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet">

    <!-- Kakao Map JS File   -->
    <script src="/assets/js/key.js"></script>
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=95bee30736d3ca3d735d6211401c9238&libraries=services,clusterer,drawing"></script>

</head>
<body>
<!-- ======= Header ======= -->
<header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

        <a href="index.html" class="logo d-flex align-items-center">
            <!-- Uncomment the line below if you also wish to use an image logo -->
            <!-- <img src="assets/img/logo.png" alt=""> -->
            <h1>Enjoy Trip</h1>
        </a>

        <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
        <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
        <nav id="navbar" class="navbar">
            <ul>
                <li><a href="pricing.html">여행계획</a></li>
                <li><a href="contact.html">지역 관광지</a></li>
                <li class="dropdown"><a href="#"><span>홍길동</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
                    <ul>
                        <li><a href="#">프로필 관리</a></li>
                        <li><a href="#">내 여행</a></li>
                        <li><a href="#">공지사항 / FAQ</a></li>
                    </ul>
                </li>
                <li><a class="get-a-quote" href="get-a-quote.html">Log In / Sign Up</a></li>
            </ul>
        </nav><!-- .navbar -->

    </div>
</header><!-- End Header -->
<!-- End Header -->

<!-- ======= Breadcrumbs ======= -->
<div class="breadcrumbs">
    <div class="page-header d-flex align-items-center" style="background-color: #8CC7D9;">
        <div class="container position-relative">
            <div class="row d-flex justify-content-center">
                <div class="col-lg-6 text-center">
                    <h2>지역별 인기 관광지 <br> TOP 10</h2>
                    <p>전국 어디든, 지역별 인기 관광지를 검색해보세요!</p>
                </div>
            </div>
        </div>
    </div>
</div><!-- End Breadcrumbs -->

<!-- Map Section -->
<div class="col-md-9 mx-auto container mb-5">
    <form class="d-flex my-3">
        <select id="area1List" class="form-select me-2">
            <option value="">시도를 선택하세요</option>
        </select>
        <select id="area2List" class="form-select me-2">
            <option value="">구군을 선택하세요</option>
        </select>

        <select id="cat1List" class="form-select me-2">
            <option value="">대분류 선택하세요</option>
        </select>
        <select id="cat2List" class="form-select me-2">
            <option value="">중분류 선택하세요</option>
        </select>
        <select id="cat3List" class="form-select me-2">
            <option value="">소분류 선택하세요</option>
        </select>
        <button type="button" class="btn btn-outline-success" id="btnSearch">검색</button>
    </form>

    <!-- kakao map start -->
    <div id="map" class="mt-3" style="width: 100%; height: 400px"></div>
    <!-- kakao map end -->

    <!-- 관광지 table -->
    <div id="table-container"></div>
    <!-- End 관광지 table -->
</div>
<!-- End Map Section -->

<!-- ======= Footer ======= -->
<footer id="footer" class="footer">

    <div class="container">
        <div class="row gy-4">
            <div class="col-lg-5 col-md-12 footer-info">
                <a href="index.html" class="logo d-flex align-items-center">
                    <span>Logis</span>
                </a>
                <p>Cras fermentum odio eu feugiat lide par naso tierra. Justo eget nada terra videa magna derita valies darta donna mare fermentum iaculis eu non diam phasellus.</p>
                <div class="social-links d-flex mt-4">
                    <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
                </div>
            </div>

            <div class="col-lg-2 col-6 footer-links">
                <h4>Useful Links</h4>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Terms of service</a></li>
                    <li><a href="#">Privacy policy</a></li>
                </ul>
            </div>

            <div class="col-lg-2 col-6 footer-links">
                <h4>Our Services</h4>
                <ul>
                    <li><a href="#">Web Design</a></li>
                    <li><a href="#">Web Development</a></li>
                    <li><a href="#">Product Management</a></li>
                    <li><a href="#">Marketing</a></li>
                    <li><a href="#">Graphic Design</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
                <h4>Contact Us</h4>
                <p>
                    A108 Adam Street <br>
                    New York, NY 535022<br>
                    United States <br><br>
                    <strong>Phone:</strong> +1 5589 55488 55<br>
                    <strong>Email:</strong> info@example.com<br>
                </p>

            </div>

        </div>
    </div>

    <div class="container mt-4">
        <div class="copyright">
            &copy; Copyright <strong><span>Logis</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/logis-bootstrap-logistics-website-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </div>

</footer><!-- End Footer -->
<!-- End Footer -->

<a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<div id="preloader"></div>

<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>

<script>
    // areaBsedList1 Service 를 이용한다.
    // BackEnd 를 이용하므로, areaCode 와 categoryCode 를 조건으로 모두 포함하는 페이지이다.

    // 공유 전역 변수
    let areaCode = "";
    let sigunguCode = "";
    let cat1 = "";
    let cat2 = "";
    let cat3 = "";

    window.onload = async function () {
        await getArea1List();
        await getCat1List();

        document.querySelector("#btnSearch").onclick = function () {
            sigunguCode = document.querySelector("#area2List").value;
            cat3 = document.querySelector("#cat3List").value;
            getList();
        };
    };

    async function getList() {
        let url = `/trip/list`;
        let urlParams = `?areaCode=${areaCode}&sigunguCode=${sigunguCode}&cat1=${cat1}&cat2=${cat2}&cat3=${cat3}`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);
        makeList(data);

        let itemList = data.response.body.items.item;
        console.log(itemList);
        makeTable(itemList.slice(0, 10));
    }

    async function getArea1List() {
        let url = `/trip/area`;
        let urlParams = `?areaCode=`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);

        let codeList = data.response.body.items.item;
        console.log(codeList);

        let listHtml = `<option value=''>시도를 선택하세요</option>`;
        codeList.forEach((el) => {
            listHtml += `<option value='${el.code}'>${el.name}</option>`;
        });
        document.querySelector("#area1List").innerHTML = listHtml;

        // change event handler
        document.querySelector("#area1List").onchange = function (e) {
            areaCode = e.target.value;
            getArea2List();
        };
    }

    async function getArea2List() {
        let url = `/trip/area`;
        let urlParams = `?areaCode=${areaCode}`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);

        let codeList = data.response.body.items.item;
        console.log(codeList);

        let listHtml = `<option value=''>구군을 선택하세요</option>`;
        codeList.forEach((el) => {
            listHtml += `<option value='${el.code}'>${el.name}</option>`;
        });
        document.querySelector("#area2List").innerHTML = listHtml;
    }

    async function getCat1List() {
        let url = `/trip/category`;
        let urlParams = `?cat1=&cat2=`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);

        let codeList = data.response.body.items.item;
        console.log(codeList);

        let listHtml = `<option value=''>대분류 선택하세요</option>`;
        codeList.forEach((el) => {
            listHtml += `<option value='${el.code}'>${el.name}</option>`;
        });
        document.querySelector("#cat1List").innerHTML = listHtml;

        // change event handler
        document.querySelector("#cat1List").onchange = function (e) {
            cat1 = e.target.value;
            getCat2List();
        };
    }

    async function getCat2List() {
        let url = `/trip/category`;
        let urlParams = `?cat1=${cat1}&cat2=`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);

        let codeList = data.response.body.items.item;
        console.log(codeList);

        let listHtml = `<option value=''>중분류 선택하세요</option>`;
        codeList.forEach((el) => {
            listHtml += `<option value='${el.code}'>${el.name}</option>`;
        });
        document.querySelector("#cat2List").innerHTML = listHtml;

        // change event handler
        document.querySelector("#cat2List").onchange = function (e) {
            cat2 = e.target.value;
            getCat3List();
        };
    }

    async function getCat3List() {
        let url = `/trip/category`;
        let urlParams = `?cat1=${cat1}&cat2=${cat2}`;

        let response = await fetch(url + urlParams);
        let data = await response.json();
        console.log(data);

        let codeList = data.response.body.items.item;
        console.log(codeList);

        let listHtml = `<option value=''>소분류 선택하세요</option>`;
        codeList.forEach((el) => {
            listHtml += `<option value='${el.code}'>${el.name}</option>`;
        });
        document.querySelector("#cat3List").innerHTML = listHtml;
    }

    // 카카오지도
    var mapContainer = document.getElementById("map"), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.500613, 127.036431), // 지도의 중심좌표
            level: 3, // 지도의 확대 레벨
        };

    // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var positions; // marker 배열.
    function makeList(data) {
        let trips = data.response.body.items.item;
        positions = [];
        trips.forEach((area) => {
            let markerInfo = {
                title: area.title,
                latlng: new kakao.maps.LatLng(area.mapy, area.mapx),
            };
            positions.push(markerInfo);
        });
        displayMarker();
    }

    function makeTable(itemList) {
        // 기존에 존재하는 테이블 삭제
        let tableContainer = document.getElementById('table-container');
        let existingTable = tableContainer.querySelector('table');
        if (existingTable) {
            existingTable.remove();
        }

        // HTML 테이블 생성
        let table = document.createElement('table');
        table.classList.add('table', 'table-striped', 'table-hover');
        let headerRow = table.insertRow();
        headerRow.classList.add('table-dark');
        headerRow.insertCell().textContent = '번호';
        headerRow.insertCell().textContent = '관광지';
        headerRow.insertCell().textContent = '주소';

        // 추출한 10개의 데이터를 테이블에 추가
        for (let i = 0; i < itemList.length; i++) {
            let item = itemList[i];
            let row = table.insertRow();
            // 좌표값 저장
            row.setAttribute('data-x', item.mapx);
            row.setAttribute('data-y', item.mapy);
            // row 생성
            row.insertCell().textContent = i + 1;
            row.insertCell().textContent = item.title;
            row.insertCell().textContent = item.addr1;

            // 클릭 이벤트 추가
            row.addEventListener('click', function() {
                // 해당 row의 x, y 좌표 정보 추출
                let x = this.getAttribute('data-x');
                let y = this.getAttribute('data-y');

                console.log("x :" + x)
                console.log("y :" + y)
                // 이동할 위도 경도 위치를 생성합니다
                var moveLatLon = new kakao.maps.LatLng(y, x);

                // 지도 중심을 부드럽게 이동시킵니다
                // 만약 이동할 거리가 지도 화면보다 크면 부드러운 효과 없이 이동합니다
                map.panTo(moveLatLon);
            });
        }

        // 테이블을 HTML에 삽입
        tableContainer.appendChild(table);
    }

    function displayMarker() {
        // 마커 이미지의 이미지 주소입니다
        var imageSrc =
            "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < positions.length; i++) {
            // 마커 이미지의 이미지 크기 입니다
            var imageSize = new kakao.maps.Size(24, 35);

            // 마커 이미지를 생성합니다
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: positions[i].latlng, // 마커를 표시할 위치
                title: positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                image: markerImage, // 마커 이미지
            });
        }

        // 첫번째 검색 정보를 이용하여 지도 중심을 이동 시킵니다
        map.setCenter(positions[0].latlng);
    }

</script>

<script
        type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=95bee30736d3ca3d735d6211401c9238&libraries=services,clusterer,drawing"
></script>


</body>
</html>